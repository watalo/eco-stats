## 第12章 面板数据

![[面板数据.svg]]

## 12.1 面板数据的特点

> #定义 面板数据
> 一段时间内跟踪同一组个体的数据。

分类：

|    分类     |       分类准则       |  特点   |
| :-------: | :--------------: | :---: |
|    短面板    |      n、T的大小      | n小、T大 |
|    长面板    |                  | n大、T小 |
|   动态面板    |   是否有被解释变量滞后项    |   有   |
|   静态面板*   |                  |   否   |
|   平衡面板*   | 每个时期样本中的个体是否完全相同 |   是   |
|   非平衡面板   |                  |   否   |
| *：重点关注的类型 |                  |       |

优点：
- 可以解决遗漏变量问题
	- 前提是个体差异不随时间而改变
- 提供更多个体动态行为的信息
- 样本容量较大
## 12.2 面板数据的估计策略

基本思路：
1. 最容易想到的办法：<span style="color:#00b0f0">混合回归</span>
	- 直接把全部数据混合起来用做回归分析
		- 假定了每个个体拥有完全相同的回归方程
	- 忽略了个体不可观测的异质性，而异质性可能与解释变量相关，导致估计不一致。
2. 另一个办法：<span style="color:#00b0f0">每个个体估计单独的回归方程</span>
	- 样本不足，尤其是短面板
3. 只能折中：<span style="color:#00b0f0">个体效应模型</span>
	- 假定个体的回归方程拥有相同斜率，但截距项不同
		- 用于捕捉异质性
	- 模型：$$y_{it}=x_{it}’\beta+z_i\delta+u_i+\epsilon_{it} \tag{12.3}$$
		- $z_i$ ：不随时间变化的个体特征
		- $x_{it}$ ：可随时间和个体变化
		- $u_i+\epsilon_{it}$ ：复合扰动项
			- $u_i$ ：个体效应，个体异质性的截距项
				- <span style="color:#00b0f0">固定效应模型</span>：与某个解释变量相关
				- <span style="color:#00b0f0">随机效应模型</span>：与所有解释变量均不相关
			- $\epsilon_{it}$：个殊性扰动项，可随个体和时间变化
				- 一般假设iid
				- 与 $u_{it}$ 相互独立
## 12.3 混合回归

如果面板数据中个体都拥有完全相同的回归方程，个体效应 $u_i=\alpha$ 为常数，就变成了多元线性回归模型。可以直接使用OLS进行回归。
- 基本假设是不存在个体效应，因此需要进行统计检验。
	- 固定效应
		- 个体固定效应
			- 组内估计量
			- LSDV法
			- 一阶差分法
		- 时间固定效应
			- LSDV法
	- 随机效应
		- 准离差模型：FGLS法
		- 组间估计量

<span style="color:#00b0f0">聚类（cluster）</span>：每个个体不同时期的所有观测值
<span style="color:#00b0f0">聚类样本</span>：样本可分为不同的聚类，同一聚类的观测值相关，不同聚类不相关。
<span style="color:#00b0f0">聚类稳健的标准误</span>：聚类样本仍可进行OLS估计，但需要使用聚类稳健标准误
- 是真实标准误的一致估计
- 是异方差稳健的标准误
- 更适用于T＞n的情况
## 12.4 固定效应模型：组内估计量

因 $u_i$ 与某解释变量相关，OLS不一致。所以，可通过变换模型消除个体效应 $u_i$ 。
1. （12.3）两边对时间取平均值$$\overline y_i = \overline x_i'\beta+z_i'\delta + u_i + \overline \epsilon_i \tag{12.4}$$
2. (12.3)-(12.4)$$\widetilde{y_i} = \widetilde{x}_{it}'\beta + \widetilde{ \epsilon_{it}} \tag{12.6}$$
3. 使用OLS估计出<span style="color:#00b0f0">固定效应估计量</span> $\beta$，记为$\hat \beta_{FE}$，也称 <span style="color:#00b0f0">组内估计量</span>

组内估计量的特点：
- 【优点】：即使个体效应与解释变量相关，也可得到一致估计
- 可能存在自相关，应使用以每个个位为聚类的聚类稳健标准误
- 【缺点】：无法估计 $\delta$ 
## 12.5 固定效应模型：LSDV法

针对 $u_i$ ，传统上将其视为个体 i 的待估参数——截距项。
1. 引入(n-1)个 个体虚拟变量。模型变为$$\overline y_i = \alpha+\overline x_i'\beta+z_i'\delta + \sum_{i=2}^n\gamma_iD_i + \overline \epsilon_i \tag{12.7}$$
2. 用OLS估计（12.7）,称为<span style="color:#00b0f0">最小二乘虚拟变量法（Least squares dummy variable）</span>

 LSDV的特点：
 - 【优点】：可以得到对个体异质性 $u_i$ 的估计
 - 【缺点】：如果n很大，将引入特别多的虚拟变量
## 12.6 固定效应模型：一阶差分法

对（12.3）两边做一阶差分可消除个体效应，也可用OLS估计<span style="color:#00b0f0">一阶差分估计量</span>$\beta$ ，记为 $\hat \beta_{FD}$。
## 12.7 时间固定效应

有时可能存在随时间变化的遗漏变量，比如宏观经济环境。在（12.3）中加入时间固定效应（$\lambda_t$）：$$y_{it}=x_{it}’\beta+z_i\delta+\lambda_t+u_i+\epsilon_{it} \tag{12.10}$$
- 使用LSDV法估计，引入T-1个时间虚拟变量$$y_{it}=\alpha+x_{it}’\beta+z_i\delta+\sum_{t=2}^T\gamma_tD_t+u_i+\epsilon_{it} \tag{12.11}$$
- 有时为节省参数，可引入时间趋势项：$$y_{it}=x_{it}’\beta+z_i\delta+\gamma t+u_i+\epsilon_{it} \tag{12.12}$$

> 通过检验时间虚拟变量的<span style="color:#00b0f0">联合显著性</span>来判断是否应使用双向固定效应模型。
## 12.8 随机效应模型

因为存在自相关性，所以OLS不是最有效率的，可进行FGLS估计。
1. 使用（12.20）来估计 $\theta$，$$\hat\theta \equiv1-\frac{\hat\sigma_{\epsilon}}{\sqrt{T\hat\sigma_u^2+\hat\sigma_{\epsilon}^2}} \tag{12.20}$$
	- $\sigma_u^2 + \sigma_{\epsilon}^2$：用 `OLS的残差` 进行估计
	- $\sigma_{\epsilon}^2$：用 `FE的残差` 进行估计
2. 再用FGLS估计原模型，即可得到<span style="color:#00b0f0">随机效应估计量（random effects estimatior）</span>，记为 $\hat\beta_{RE}$

 > 假设扰动项服从正态分布，可写出样本的似然函数，可以使用MLE。
## 12.9 组间估计量

对（12.4）进行OLS回归得到<span style="color:#00b0f0">组间估计量</span>，记为$\hat\beta_{BE}$ 。
$$\overline y_i = \overline x_i'\beta+z_i'\delta + u_i + \overline \epsilon_i \tag{12.21}$$
## 12.10 拟合优度的度量

<span style="color:#00b0f0">整体 $R^2$ </span>= $[Corr(y_{it},x_{it}'\hat\beta+z_i'\hat\delta)]^2$
- 对应原模型（12.3）：$\overline y_i = \overline x_i'\beta+z_i'\delta + u_i + \overline \epsilon_i$
<span style="color:#00b0f0">组内 $R^2$ </span>= $[Corr(\widetilde{y}_{it},\widetilde{x}_{it}'\hat\beta)]^2$
- 组内离差模型（12.6）：$\widetilde{y_i} = \widetilde{x}_{it}'\beta + \widetilde{ \epsilon_{it}}$
<span style="color:#00b0f0">组间 $R^2$ </span>= $[Corr(\overline y_{it},\overline x_{it}'\hat\beta+z_i'\hat\delta)]^2$
- 对时间求平均值的模型（12.21）：$\overline y_i = \overline x_i'\beta+z_i'\delta + u_i + \overline \epsilon_i$
## 12.11 非平衡面板

每个时期观测到的个体不完全相同，称为<span style="color:#00b0f0">非平衡面板</span>。
- 模型中运用了对时间的离差或平均值的，均没有影响。
## 12.12 究竟该用固定效应还是随机效应模型

原假设：$H_0$：$u_i$ 与 $x_{it}$，$z_i$ 不相关 （随机效应模型为正确模型）
- 原理：
	- FE 两种模型下 都是一致的
	- RE 如果成立，效率比FE高
	- 都收敛于真实值
- 使用<span style="color:#00b0f0">Hausman检验统计量</span>
	- 存在异方差情况，需使用异方差稳健的hausman检验
## 12.13 面板模型的python命令及实例

### 1.面板数据的设定

### 2.混合回归

### 3.固定效应






#### LSDV

```python
import pandas as pd
import statsmodels.api as sm
from linearmodels.panel import PanelOLS

lin = pd.read_stata('lin_1992.dta')
lin.dropna(inplace=True)
panel_lin = lin.set_index(['province', 'year']) 
# panel_lin.isna().any() 
exog = panel_lin[['ltlan', 'ltwlab', 'ltpow',
                  'ltfer','hrs','mipric1',
                  'giprice','mci','ngca']]
dep = panel_lin['ltvfo']
exog = sm.add_constant(exog)

mod = PanelOLS(dependent=dep, exog=exog, entity_effects=True)
fe_res = mod.fit(use_lsdv=True, 
				 cov_type='clustered',
                 cluster_entity=True,
                 group_debias=True)
print(fe_res)
```


```
                          PanelOLS Estimation Summary                           
================================================================================
Dep. Variable:                  ltvfo   R-squared:                        0.8746
Estimator:                   PanelOLS   R-squared (Between):              0.5636
No. Observations:                 476   R-squared (Within):               0.8746
Date:                Thu, May 02 2024   R-squared (Overall):              0.6525
Time:                        00:21:54   Log-likelihood                    412.62
Cov. Estimator:             Clustered                                           
                                        F-statistic:                      340.20
Entities:                          28   P-value                           0.0000
Avg Obs:                       17.000   Distribution:                   F(9,439)
Min Obs:                       17.000                                           
Max Obs:                       17.000   F-statistic (robust):             274.25
                                        P-value                           0.0000
Time periods:                      17   Distribution:                   F(9,439)
Avg Obs:                       28.000                                           
Min Obs:                       28.000                                           
Max Obs:                       28.000                                           
                                                                                
                             Parameter Estimates                              
==============================================================================
            Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI
------------------------------------------------------------------------------
const          2.3379     0.8552     2.7337     0.0065      0.6571      4.0187
ltlan          0.6370     0.1681     3.7888     0.0002      0.3066      0.9675
ltwlab         0.1388     0.0625     2.2219     0.0268      0.0160      0.2615
ltpow          0.0577     0.0756     0.7639     0.4454     -0.0908      0.2062
ltfer          0.1826     0.0436     4.1895     0.0000      0.0970      0.2683
hrs            0.2134     0.0391     5.4564     0.0000      0.1365      0.2903
mipric1        0.0544     0.0590     0.9208     0.3577     -0.0617      0.1704
giprice       -0.0151     0.0246    -0.6157     0.5384     -0.0635      0.0332
mci            0.1944     0.0771     2.5226     0.0120      0.0429      0.3458
ngca           0.7562     0.3821     1.9789     0.0484      0.0052      1.5072
==============================================================================

F-test for Poolability: 43.410
P-value: 0.0000
Distribution: F(27,439)

Included effects: Entity
```

command：

```Stata
.reg ltvfo ltlan ltwlab ltpow ltfer hrs mprice1 giprice mci ngca i.province,vce(cluster province)
```

Result：

```plaintext

Linear regression                               Number of obs     =        476
                                                F(8, 27)          =          .
                                                Prob > F          =          .
                                                R-squared         =     0.9644
                                                Root MSE          =     .10562

                               (Std. err. adjusted for 28 clusters in province)
-------------------------------------------------------------------------------
              |               Robust
        ltvfo | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
--------------+----------------------------------------------------------------
        ltlan |   .6416702   .1713427     3.74   0.001     .2901041    .9932364
       ltwlab |   .1450755   .0630223     2.30   0.029     .0157645    .2743865
        ltpow |   .0452296   .0784703     0.58   0.569    -.1157782    .2062373
        ltfer |   .1797905   .0442688     4.06   0.000     .0889583    .2706226
          hrs |   .2029486   .0354117     5.73   0.000     .1302899    .2756074
      mprice1 |   .0006729   .0005079     1.32   0.196    -.0003693    .0017151
      giprice |  -.0013382   .0290117    -0.05   0.964    -.0608653    .0581888
          mci |   .1891754   .0804195     2.35   0.026     .0241682    .3541825
         ngca |   .7297664   .3945877     1.85   0.075    -.0798607    1.539394
              |
     province |
     beijing  |  -.1619813   .1213152    -1.34   0.193    -.4108995    .0869369
      fujian  |   .0544773   .0490674     1.11   0.277    -.0462007    .1551554
       gansu  |  -.8139553   .1359346    -5.99   0.000     -1.09287   -.5350405
   guangdong  |   -.002376   .0555072    -0.04   0.966    -.1162674    .1115153
     guangxi  |  -.2251663   .0562392    -4.00   0.000    -.3405595    -.109773
     guizhou  |  -.2355835   .0616207    -3.82   0.001    -.3620187   -.1091482
       hebei  |   -.291287   .0982331    -2.97   0.006    -.4928447   -.0897293
heilongjiang  |  -.1323937   .2835992    -0.47   0.644    -.7142913    .4495038
       henan  |  -.0879974   .0437877    -2.01   0.055    -.1778423    .0018476
       hubei  |   .1185037   .0346434     3.42   0.002     .0474212    .1895861
       hunan  |  -.0341996   .0620103    -0.55   0.586    -.1614341    .0930349
     jiangsu  |   .1196285   .0336721     3.55   0.001      .050539     .188718
     jiangxi  |  -.1288114   .0600373    -2.15   0.041    -.2519977    -.005625
       jilin  |  -.2169142   .2213311    -0.98   0.336    -.6710481    .2372196
    liaoning  |  -.2700503   .1692465    -1.60   0.122    -.6173153    .0772148
     neimong  |  -.9220521   .2507862    -3.68   0.001    -1.436623   -.4074812
     ningxia  |  -.8722008   .1932301    -4.51   0.000    -1.268676   -.4757254
     qinghai  |  -.6957976   .1495503    -4.65   0.000    -1.002649   -.3889458
     shaanxi  |  -.3348829   .0920457    -3.64   0.001    -.5237452   -.1460206
   shangdong  |  -.0033147   .0575967    -0.06   0.955    -.1214933    .1148639
    shanghai  |   .1357669   .0669881     2.03   0.053    -.0016814    .2732153
      shanxi  |  -.5274659   .1485483    -3.55   0.001    -.8322619   -.2226699
     sichuan  |   .0180128   .0329135     0.55   0.589      -.04952    .0855457
     tianjin  |  -.2905847   .1163564    -2.50   0.019    -.5293283   -.0518411
    xinjiang  |   -.389744   .2341088    -1.66   0.108    -.8700956    .0906077
      yunnan  |  -.2760217   .0644186    -4.28   0.000    -.4081976   -.1438457
    zhejiang  |    .179848   .0815899     2.20   0.036     .0124393    .3472567
              |
        _cons |   2.483451   .8334385     2.98   0.006     .7733769    4.193526
-------------------------------------------------------------------------------

```

### 4.随机效应

### 5.豪斯曼检验

### 6.组间统计量